USE netsparker;  -- Ensure you're in the correct database
GO

-- Query to get user logs from Useractions, Useractionparameters, and users
SELECT 
    C.name AS UserName,
    C.email AS UserEmail,
    (SELECT TOP 1 D.name 
     FROM Roles D
     JOIN UserRolewebsiteGroupMappings E ON D.Id = E.RoleID 
     WHERE C.Id = E.UserId) AS Role,
    B.Name AS ActionName,
    B.value AS ActionValue,
    B.CreatedAt AS ActionCreatedAt,
    NULL AS RequestData,       -- Placeholder for AuditLogs RequestData
    NULL AS Message,           -- Placeholder for AuditLogs Message
    NULL AS DeletedOn          -- Placeholder for AuditLogs DeletedOn
FROM 
    Useractions A
JOIN 
    Useractionparameters B ON A.Id = B.userAction_Id
JOIN 
    users C ON A.userId = C.Id

UNION ALL

-- Query to get logs from dbo.AuditLogs
SELECT 
    users.name AS UserName,
    users.email AS UserEmail,
    NULL AS Role,                 -- Assuming role information is not in AuditLogs
    NULL AS ActionName,            -- Placeholder for ActionName (not in AuditLogs)
    dbo.AuditLogs.RequestData AS ActionValue, -- Using RequestData as ActionValue for consistency
    dbo.AuditLogs.CreatedAt AS ActionCreatedAt,
    dbo.AuditLogs.RequestData,     -- RequestData from AuditLogs
    dbo.AuditLogs.Message,         -- Message from AuditLogs
    dbo.AuditLogs.DeletedOn        -- DeletedOn from AuditLogs
FROM 
    dbo.AuditLogs
JOIN 
    users ON dbo.AuditLogs.UserId = users.Id;   -- Assuming AuditLogs has UserId to link with users table
