USE netsparker;  -- Ensure you're in the correct database
GO

SELECT 
    U.name AS UserName,         -- User's name
    A.UserId,                   -- User ID from AuditLogs
    A.RequestData,              -- Request data from AuditLogs
    A.Message,                  -- Message from AuditLogs
    A.CreatedAt,                -- Created timestamp from AuditLogs
    A.DeletedOn,                -- Deleted timestamp from AuditLogs
    A.DeletedById,              -- ID of the user who deleted the log (if applicable)
    A.Timestamp,                -- Timestamp of the log entry from AuditLogs
    A.EndpointType,             -- Type of endpoint from AuditLogs
    (SELECT TOP 1 R.name        -- Role name from Roles table
     FROM UserRolewebsiteGroupMappings UR
     JOIN Roles R ON UR.RoleID = R.Id
     WHERE U.Id = UR.UserId) AS Role
FROM 
    dbo.AuditLogs A
JOIN 
    users U ON A.UserId = U.Id;  -- Join AuditLogs with users table
