USE netsparker;  -- Ensure you're in the correct database
GO

-- Query to get user logs from Useractions, Useractionparameters, and users
SELECT 
    C.name AS UserName,
    C.email AS UserEmail,
    (SELECT TOP 1 D.name 
     FROM Roles D
     JOIN UserRolewebsiteGroupMappings E ON D.Id = E.RoleID 
     WHERE C.Id = E.UserId) AS Role,
    B.Name AS ActionName,
    B.value AS ActionValue,
    B.CreatedAt AS ActionCreatedAt,
    NULL AS RequestData,   -- Placeholder for RequestData, as it's not applicable here
    NULL AS Message,       -- Placeholder for Message, as it's not applicable here
    NULL AS DeletedOn      -- Placeholder for DeletedOn, as it's not applicable here
FROM 
    Useractions A
JOIN 
    Useractionparameters B ON A.Id = B.userAction_Id
JOIN 
    users C ON A.userId = C.Id

UNION ALL

-- Query to get logs from AuditLogs
SELECT 
    C.name AS UserName,
    C.email AS UserEmail,
    (SELECT TOP 1 D.name 
     FROM Roles D
     JOIN UserRolewebsiteGroupMappings E ON D.Id = E.RoleID 
     WHERE C.Id = E.UserId) AS Role,
    NULL AS ActionName,    -- Placeholder for ActionName, as it's not applicable here
    NULL AS ActionValue,    -- Placeholder for ActionValue, as it's not applicable here
    CreatedAt AS ActionCreatedAt,
    RequestData,
    Message,
    DeletedOn
FROM 
    dbo.AuditLogs
JOIN 
    users C ON dbo.AuditLogs.UserId = C.Id;  -- Join AuditLogs with users
