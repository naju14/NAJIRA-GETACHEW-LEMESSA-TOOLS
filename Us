USE netsparker;  -- Ensure you're in the correct database
GO

SELECT 
    U.name AS UserName,         -- User's name
    A.UserId,                   -- User ID from AuditLogs
    A.RequestData,              -- Request data from AuditLogs
    A.Message,                  -- Message from AuditLogs
    A.CreatedAt,                -- Created timestamp from AuditLogs
    A.DeletedOn,                -- Deleted timestamp from AuditLogs
    A.DeletedById,              -- ID of the user who deleted the log (if applicable)
    A.Timestamp,                -- Timestamp of the log entry from AuditLogs
    A.EndpointType,             -- Type of endpoint from AuditLogs
    (SELECT TOP 1 R.name        -- Role name from Roles table
     FROM UserRolewebsiteGroupMappings UR
     JOIN Roles R ON UR.RoleID = R.Id
     WHERE U.Id = UR.UserId) AS Role
FROM 
    dbo.AuditLogs A
JOIN 
    users U ON A.UserId = U.Id;  -- Join AuditLogs with users table



SELECT 
    C.name AS UserName,
    C.email AS UserEmail,
    D.name AS Role,                -- Role from Roles table
    B.Name AS ActionName,          -- Action name from Useractionparameters
    B.value AS ActionValue,        -- Action value from Useractionparameters
    B.CreatedAt AS ActionCreatedAt  -- Created timestamp from Useractionparameters
FROM 
    Useractions A
JOIN 
    Useractionparameters B ON A.Id = B.userAction_Id
JOIN 
    users C ON A.userId = C.Id
LEFT JOIN 
    UserRolewebsiteGroupMappings E ON C.Id = E.UserId  -- Join for user roles
LEFT JOIN 
    Roles D ON E.RoleID = D.Id;  -- Join to get role names
