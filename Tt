
SELECT * 
FROM SA.rock_stealth.openshares;

SELECT DISTINCT (rock_dns_path) 
FROM SA.rock_stealth.openshares;

-- Find Duplicates in rock_dns_path
SELECT rock_dns_path, COUNT(*) AS duplicate_count
FROM SA.rock_stealth.openshares
GROUP BY rock_dns_path
HAVING COUNT(*) > 1;

-- Delete Duplicates in rock_dns_path where rock_load_date is between 2020 and 2021
WITH CTE AS (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY rock_dns_path ORDER BY rock_load_date) AS row_num
    FROM SA.rock_stealth.openshares
    WHERE rock_load_date BETWEEN '2020-01-01' AND '2021-12-31'
)
DELETE FROM SA.rock_stealth.openshares
WHERE rock_dns_path IN (
    SELECT rock_dns_path
    FROM CTE
    WHERE row_num > 1
);
